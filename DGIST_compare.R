
setwd('/storage2/Project/CSC/10X/DGIST_data')

DGIST=readRDS(file="BC_seurat.rds")

DGIST@raw.data      DGIST@var.genes     DGIST@meta.data     DGIST@assay         DGIST@cell.names    DGIST@calc.params   DGIST@misc
DGIST@data          DGIST@is.expr       DGIST@project.name  DGIST@hvg.info      DGIST@cluster.tree  DGIST@kmeans        DGIST@version
DGIST@scale.data    DGIST@ident         DGIST@dr            DGIST@imputed       DGIST@snn           DGIST@spatial    

#####################################################

library(Seurat)
library(scater)
library(dplyr)

pdf("DGIST_tsne.pdf", width=15, height=9)
TSNEPlot(DGIST, pt.size = 0.5, label.size = 4, do.label = TRUE, cex=2)
dev.off()

cell.num <- table(DGIST@ident)


library(ggplot2)
library(reshape)
library(plyr)
library(scales)
library(TDMR)

setwd("/home/subin95/CSC/10X")
df <- read.table("DGIST_cell.txt", sep="\t", header=TRUE)
df.m <- melt(df)

df_rmSum <- df.m[df.m$variable!="sum",]
df_final <- cbind(df_rmSum, percentage=c("1.73%","30.97%","6.07%","7.27%","53.96%","1.49%","39.11%","2.95%","9.65%","46.76%","7.4%","8.95%","3%","1.46%","76.59%","10%","7.24%","7.75%","0.94%","73.74%","2.06%","40.03%","8.26%","10.09%","39.54%"))
write.table(df_final, file = "DGIST_cell.txt", sep="\t", row.names=FALSE)

df <- read.table("DGIST_cell.txt", sep="\t", header=TRUE)

pdf("DGIST_cell.pdf", width=10, height=10)
p <- ggplot(df, aes(fill=Cell.Type, y=value, x=variable))+geom_bar( stat="identity")+geom_text(aes(label = percentage),size =3.5, position = position_stack(vjust = 0.5),colour="white",fontface = "bold")
base_size <- 15
p + ggtitle("DGIST # of Cells by Cell Types") + 
theme_grey(base_size = base_size) + labs(x = "Samples", y = "Cells",fontface = "bold") + 
scale_color_manual(values = c("#c90000",  "#ea9800",  "#04a327","#0073C2FF", "#6e0087")) + scale_fill_manual(values = c("#c90000",  "#ea9800",  "#04a327","#0073C2FF", "#6e0087"))
dev.off()

df <- df[df$Cell.Type!="Putative Cancer cells",]
df_full <- df[df$variable!="PE23",]

pdf("DGIST_full.pdf", width=10, height=10)
p <- ggplot(df_full, aes(fill=Cell.Type, y=value, x=variable))+geom_bar(stat="identity")+geom_text(aes(label = percentage),size =4.5, position = position_stack(vjust = 0.5),colour="white",fontface = "bold")
base_size <- 20
p + ggtitle("DGIST # of Cells by Cell Types") + 
theme_grey(base_size = base_size) + labs(x = "Samples", y = "Cells",fontface = "bold") + 
scale_color_manual(values = c("#c90000",  "#ea9800",  "#04a327", "#6e0087")) + scale_fill_manual(values = c("#c90000",  "#ea9800",  "#04a327", "#6e0087"))
dev.off()


############################################################
##tool 별 corr plot그리는 code###############################
############################################################
source("https://bioconductor.org/biocLite.R")
biocLite("ggcorrplot")

library(ggcorrplot)
setwd("/storage2/Project/CSC/10X/DGIST_data")

df <- read.table("/storage2/Project/CSC/10X/DGIST_data/corr_mark2.txt", sep="\t", header=TRUE)
rownames(df) <- df$X
df <- df[-1]

#corr <- round(cor(df),2)
corr <- cor(df)
cor.test(df$DGIST, df$CIBERSORT)

# Pearson's product-moment correlation

#data:  df$DGIST and df$CIBERSORT
#t = 7.6758, df = 13, p-value = 3.507e-06
#alternative hypothesis: true correlation is not equal to 0
#95 percent confidence interval:
# 0.7324729 0.9683825
#sample estimates:
#      cor 
#0.9051184 

pdf("corrplot_mark2.pdf", width=10, height=10)
corrplot(corr, method = "pie",type="upper",tl.col="black", tl.srt=45,addCoef.col = "black")
dev.off()


df <- read.table("cor_Monocyte_cluster6.txt", sep="\t", header=TRUE)
rownames(df) <- df$X
df <- df[-1]
corr <- cor(df)

pdf("cor_Monocyte_cluster6.pdf", width=5, height=5)
title="Monocyte_cluster6"
corrplot(corr, method = "pie",type="upper",title=title,tl.col="black", tl.srt=45,addCoef.col = "black",tl.cex =0.7,mar=c(0,0,3,0))
dev.off()

#######################################################################

load("ensemblGenes2018-01-14.RData")
DGIST=readRDS(file="BC_seurat.rds")

#Tcell

TGgene='ENSG00000184271'

pdf(paste0("PE24_CD4+Tcell_",ensemblGenes[TGgene,"external_gene_name"],"_seurat.pdf"))
df = data.frame(x=BC_seurat@dr$tsne@cell.embeddings[, "tSNE_1"], 
                y=BC_seurat@dr$tsne@cell.embeddings[, "tSNE_2"], 
                expression=BC_seurat@scale.data[TGgene,])
ggplot(df,aes(x=x, y=y, colour=expression)) + 
  geom_point(size=1) + 
  scale_colour_gradientn(colours = rev(brewer.pal(11, "RdBu"))) +
  ylab("Component 2") + 
  xlab("Component 1") + 
  theme_bw() +
  theme(text = element_text(size=20),
        panel.grid.major=element_blank(),
        panel.grid.minor=element_blank(), 
        axis.line=element_line(size=1),
        axis.ticks=element_line(size=1),
        legend.text=element_text(size=20), 
        legend.title=element_blank(),
        legend.key=element_blank(),
        axis.text.x = element_text(size=20)
  ) 
dev.off()

################################################
setwd("/storage2/Project/CSC/10X/DGIST_data")
load("/storage2/Project/CSC/10X/05_QC/PE2324252629/ensemblGenes2018-01-14.RData")
library(RColorBrewer)

library(Seurat)
library(scater)
library(dplyr)

DGIST=readRDS(file="BC_seurat.rds")


exp =  DGIST@scale.data["ENSG00000005471",]

#TGgene=CIBERSORT celltype marker gene 
TGgene=c('ENSG00000005471','ENSG00000150967','ENSG00000072818','ENSG00000087085','ENSG00000102575','ENSG00000042980','ENSG00000134028','ENSG00000156140','ENSG00000169252','ENSG00000204472','ENSG00000163568','ENSG00000161905','ENSG00000012779','ENSG00000116748','ENSG00000101280','ENSG00000164512','ENSG00000128383','ENSG00000239713','ENSG00000128284','ENSG00000221963','ENSG00000103569','ENSG00000128805','ENSG00000137486','ENSG00000141505','ENSG00000161944','ENSG00000104043','ENSG00000230223','ENSG00000172232','ENSG00000112182','ENSG00000153064','ENSG00000043039','ENSG00000127152','ENSG00000140379','ENSG00000110987','ENSG00000162373','ENSG00000125864','ENSG00000123095','ENSG00000023445','ENSG00000136573','ENSG00000138756','ENSG00000101425','ENSG00000157764','ENSG00000174672','ENSG00000109743','ENSG00000113303','ENSG00000173715','ENSG00000118292','ENSG00000171860','ENSG00000197405','ENSG00000134830','ENSG00000178538','ENSG00000164047','ENSG00000137757','ENSG00000150636','ENSG00000108702','ENSG00000181374','ENSG00000276409','ENSG00000102970','ENSG00000275385','ENSG00000172724','ENSG00000115009','ENSG00000102962','ENSG00000274736','ENSG00000275302','ENSG00000271503','ENSG00000108688','ENSG00000108700','ENSG00000118971','ENSG00000184451','ENSG00000121807','ENSG00000183625','ENSG00000160791','ENSG00000112486','ENSG00000126353','ENSG00000117281','ENSG00000134061','ENSG00000177455','ENSG00000158477','ENSG00000158485','ENSG00000158481','ENSG00000158473','ENSG00000158488','ENSG00000116824','ENSG00000090659','ENSG00000012124','ENSG00000122223','ENSG00000198821','ENSG00000139193','ENSG00000178562','ENSG00000167851','ENSG00000105383','ENSG00000104894','ENSG00000004468','ENSG00000167286','ENSG00000198851','ENSG00000160654','ENSG00000010610','ENSG00000101017',
  'ENSG00000102245','ENSG00000110448','ENSG00000013725','ENSG00000129226','ENSG00000110848','ENSG00000173762','ENSG00000125726','ENSG00000137101','ENSG00000105369','ENSG00000007312','ENSG00000121594','ENSG00000114013','ENSG00000153563','ENSG00000172116','ENSG00000153283','ENSG00000158825','ENSG00000164045','ENSG00000154162','ENSG00000148600','ENSG00000105810','ENSG00000170956','ENSG00000124469','ENSG00000205923','ENSG00000126759','ENSG00000133048','ENSG00000064886','ENSG00000182022','ENSG00000147119','ENSG00000105205','ENSG00000153923','ENSG00000132514','ENSG00000069493','ENSG00000111729','ENSG00000172243','ENSG00000155962','ENSG00000092009','ENSG00000171812','ENSG00000206561','ENSG00000163751','ENSG00000117322','ENSG00000146592','ENSG00000096006','ENSG00000109943','ENSG00000100122','ENSG00000184371','ENSG00000164400','ENSG00000119535','ENSG00000077984','ENSG00000163599','ENSG00000100448','ENSG00000172543','ENSG00000169245','ENSG00000169248','ENSG00000156234','ENSG00000163734','ENSG00000163735','ENSG00000138755','ENSG00000163464','ENSG00000180871','ENSG00000160683','ENSG00000172215','ENSG00000147231','ENSG00000135929','ENSG00000111012','ENSG00000276644','ENSG00000035664','ENSG00000164935','ENSG00000164821','ENSG00000170456','ENSG00000100150','ENSG00000065357','ENSG00000278535','ENSG00000108771','ENSG00000167261','ENSG00000197635','ENSG00000134765','ENSG00000158050','ENSG00000145088','ENSG00000105246','ENSG00000184349','ENSG00000122877','ENSG00000197561','ENSG00000159023','ENSG00000072134','ENSG00000134954','ENSG00000117036','ENSG00000124019','ENSG00000185442','ENSG00000164125','ENSG00000117560','ENSG00000135722','ENSG00000179639','ENSG00000104921','ENSG00000072694','ENSG00000162747','ENSG00000085265','ENSG00000132704','ENSG00000182511',
  'ENSG00000126262','ENSG00000090554','ENSG00000119686','ENSG00000125740','ENSG00000049768','ENSG00000171051','ENSG00000171049','ENSG00000187474','ENSG00000111816','ENSG00000151474','ENSG00000126391','ENSG00000180340','ENSG00000104290','ENSG00000197093','ENSG00000166573','ENSG00000162676','ENSG00000099998','ENSG00000010310','ENSG00000176533','ENSG00000115523','ENSG00000076716','ENSG00000183671','ENSG00000174946','ENSG00000125245','ENSG00000169508','ENSG00000183150','ENSG00000170128','ENSG00000140030','ENSG00000100351','ENSG00000228315',
  'ENSG00000197465','ENSG00000145649','ENSG00000100453','ENSG00000100450','ENSG00000113088','ENSG00000197540','ENSG00000084110','ENSG00000101336','ENSG00000140287','ENSG00000163666','ENSG00000152804','ENSG00000177374','ENSG00000277075','ENSG00000273802','ENSG00000160883','ENSG00000241106','ENSG00000196735','ENSG00000213652','ENSG00000150540','ENSG00000105991','ENSG00000163106','ENSG00000173083','ENSG00000196639','ENSG00000173110','ENSG00000135914','ENSG00000003147','ENSG00000163600','ENSG00000131203','ENSG00000137959','ENSG00000186803','ENSG00000111537','ENSG00000211898','ENSG00000211891','ENSG00000211899','ENSG00000211592','ENSG00000206066','ENSG00000140749','ENSG00000113302','ENSG00000081985','ENSG00000112115','ENSG00000115604','ENSG00000115607','ENSG00000115008','ENSG00000125538','ENSG00000115602','ENSG00000138684','ENSG00000111536','ENSG00000134460','ENSG00000100385','ENSG00000164399','ENSG00000113520','ENSG00000077238','ENSG00000113525','ENSG00000091181','ENSG00000104432','ENSG00000168685','ENSG00000145839','ENSG00000140968','ENSG00000113263','ENSG00000177272','ENSG00000178342','ENSG00000125498','ENSG00000189013','ENSG00000221957','ENSG00000240403','ENSG00000111796','ENSG00000205810',
  'ENSG00000183542','ENSG00000134539','ENSG00000150045','ENSG00000139187','ENSG00000213809','ENSG00000219941','ENSG00000115919','ENSG00000089692','ENSG00000167618','ENSG00000078081','ENSG00000213658','ENSG00000182866','ENSG00000138795','ENSG00000138039','ENSG00000239998',
  'ENSG00000239961','ENSG00000131042','ENSG00000203896','ENSG00000281005','ENSG00000118308','ENSG00000204482','ENSG00000226979','ENSG00000227507','ENSG00000213316','ENSG00000112799','ENSG00000122224','ENSG00000185247','ENSG00000111837','ENSG00000111885','ENSG00000172469','ENSG00000073803','ENSG00000104814','ENSG00000168067','ENSG00000164114','ENSG00000173926','ENSG00000019169','ENSG00000105613','ENSG00000165471','ENSG00000103313','ENSG00000112818','ENSG00000257335','ENSG00000243156','ENSG00000262406','ENSG00000008516','ENSG00000100985','ENSG00000163563','ENSG00000184313','ENSG00000156738','ENSG00000149534','ENSG00000149516','ENSG00000110077','ENSG00000178860','ENSG00000059728','ENSG00000118513','ENSG00000170476','ENSG00000168060','ENSG00000116701','ENSG00000204475','ENSG00000123405','ENSG00000165028','ENSG00000105374','ENSG00000162711','ENSG00000135577','ENSG00000086288','ENSG00000167207','ENSG00000074771','ENSG00000130751','ENSG00000196436','ENSG00000135838','ENSG00000119508','ENSG00000162068','ENSG00000198400','ENSG00000085840','ENSG00000099985','ENSG00000108405','ENSG00000083454','ENSG00000078589','ENSG00000181631','ENSG00000174944','ENSG00000175591','ENSG00000159339','ENSG00000137819','ENSG00000115687','ENSG00000009709','ENSG00000163346','ENSG00000204965','ENSG00000188389','ENSG00000197646','ENSG00000095464','ENSG00000152256','ENSG00000008438','ENSG00000100100','ENSG00000078795','ENSG00000144837','ENSG00000146070','ENSG00000149527','ENSG00000166289',
  'ENSG00000126822','ENSG00000183395','ENSG00000168081','ENSG00000163736','ENSG00000110841','ENSG00000180644','ENSG00000186652','ENSG00000135362','ENSG00000242221','ENSG00000168229','ENSG00000125384','ENSG00000160013','ENSG00000213402','ENSG00000144724','ENSG00000213413','ENSG00000115828','ENSG00000041353','ENSG00000116191','ENSG00000185989','ENSG00000068831','ENSG00000152689','ENSG00000107551','ENSG00000117602','ENSG00000143839','ENSG00000102032','ENSG00000169891','ENSG00000090104','ENSG00000127074','ENSG00000169385','ENSG00000169413','ENSG00000165496','ENSG00000225093','ENSG00000052749','ENSG00000114767','ENSG00000134321','ENSG00000196218','ENSG00000163221','ENSG00000180739','ENSG00000155307','ENSG00000169432','ENSG00000075826','ENSG00000188404','ENSG00000184702','ENSG00000164402','ENSG00000129158','ENSG00000183918','ENSG00000088827','ENSG00000142178','ENSG00000089012','ENSG00000137078','ENSG00000154839','ENSG00000141293','ENSG00000117090','ENSG00000158714','ENSG00000074803','ENSG00000221955','ENSG00000110446','ENSG00000160326','ENSG00000130876','ENSG00000137571','ENSG00000103056','ENSG00000130768','ENSG00000185338','ENSG00000079263','ENSG00000061656','ENSG00000269404','ENSG00000107742','ENSG00000126752','ENSG00000064225','ENSG00000136840','ENSG00000111728','ENSG00000035720','ENSG00000127954','ENSG00000168952','ENSG00000233402','ENSG00000073861','ENSG00000081059','ENSG00000100721','ENSG00000135605','ENSG00000129566','ENSG00000104055','ENSG00000137462','ENSG00000196664','ENSG00000101916','ENSG00000121895','ENSG00000125355','ENSG00000123610','ENSG00000173535','ENSG00000141655','ENSG00000240505','ENSG00000048462','ENSG00000186827','ENSG00000125735','ENSG00000050730','ENSG00000172236','ENSG00000277734','ENSG00000076604','ENSG00000163519',
  'ENSG00000211789','ENSG00000211788','ENSG00000211791','ENSG00000211801','ENSG00000211795','ENSG00000211793','ENSG00000211751','ENSG00000211829','ENSG00000124731','ENSG00000095970','ENSG00000112195','ENSG00000071575','ENSG00000130529','ENSG00000119121','ENSG00000165409','ENSG00000075234','ENSG00000074966','ENSG00000077498','ENSG00000160185','ENSG00000242366','ENSG00000197888','ENSG00000100373','ENSG00000136059','ENSG00000112299','ENSG00000112303','ENSG00000093134','ENSG00000128218','ENSG00000111186','ENSG00000154764','ENSG00000115085','ENSG00000124256','ENSG00000205189','ENSG00000011590','ENSG00000152518','ENSG00000176293','ENSG00000197279','ENSG00000204789','ENSG00000159885','ENSG00000187607','ENSG00000083812','ENSG00000198342')

for (i in TGgene){
  test = DGIST@scale.data[i,]
  exp <- rbind(exp,test)
}
exp_real <-exp[rownames(exp)!="exp",]
rownames(exp_real) <- TGgene

dim(exp_real)
[1]   529 55788
write.table(exp_real, file = "DGIST_CIBERSORT.txt", sep="\t", row.names=TRUE)
exp_real <- read.table(file = "DGIST_CIBERSORT.txt", sep="\t", header=TRUE)

CIBERSORT <- read.table(file="CIBERSORT_marker_gene_compare_DGIST.txt", sep='\t', header=TRUE)
rownames(CIBERSORT) <- CIBERSORT[,1]
CIBERSORT <- CIBERSORT[,-1]
> CIBERSORT$
CIBERSORT$Gene.symbol                   CIBERSORT$NK.cells.activated
CIBERSORT$B.cells.naive                 CIBERSORT$Monocytes
CIBERSORT$B.cells.memory                CIBERSORT$Macrophages.M0
CIBERSORT$Plasma.cells                  CIBERSORT$Macrophages.M1
CIBERSORT$T.cells.CD8                   CIBERSORT$Macrophages.M2
CIBERSORT$T.cells.CD4.naive             CIBERSORT$Dendritic.cells.resting
CIBERSORT$T.cells.CD4.memory.resting    CIBERSORT$Dendritic.cells.activated
CIBERSORT$T.cells.CD4.memory.activated  CIBERSORT$Mast.cells.resting
CIBERSORT$T.cells.follicular.helper     CIBERSORT$Mast.cells.activated
CIBERSORT$T.cells.regulatory..Tregs.    CIBERSORT$Eosinophils
CIBERSORT$T.cells.gamma.delta           CIBERSORT$Neutrophils
CIBERSORT$NK.cells.resting              

#naiveB <- as.matrix(CIBERSORT$B.cells.naive)
#rownames(naiveB) <- rownames(CIBERSORT)

Neut <- as.matrix(CIBERSORT$Neutrophils)
rownames(Neut) <- rownames(CIBERSORT)


#naiveB_corr = c()
#memoryB_corr = c()
#plasma_corr = c()
#restingMemoryCD4T_corr = c()
#activatedMemoryCD4T_corr = c()
#folliTh_corr = c()
#Treg_corr = c()
#restingNK_corr = c()
Neut_corr = c()

for (i in c(1:length(colnames(exp_real)))){
table <- cbind(exp_real[,i],Neut[,1])
colnames(table) <- c("DGIST","CIBERSORT")
corr <- cor(table)[1,2]
Neut_corr <- cbind(Neut_corr,corr)
}
colnames(Neut_corr) <- colnames(exp_real)

celltypes = "Neutrophils"

pdf(paste0("DGIST_",celltypes,".pdf"),width=12, height=9)
df = data.frame(x=DGIST@dr$tsne@cell.embeddings[, "tSNE_1"], 
                y=DGIST@dr$tsne@cell.embeddings[, "tSNE_2"], 
                expression=Neut_corr[1,])
ggplot(df,aes(x=x, y=y, colour=expression),mar=c(0,0,3,0)) + 
  ggtitle(paste0(celltypes, " Correlation")) +
  geom_point(size=0.5) + 
  scale_colour_gradientn(colours = rev(brewer.pal(11, "RdBu"))) +
  ylab("Component 2") + 
  xlab("Component 1") + 
  theme_bw() +
  theme(text = element_text(size=20),
        panel.grid.major=element_blank(),
        panel.grid.minor=element_blank(), 
        axis.line=element_line(size=1),
        axis.ticks=element_line(size=1),
        legend.text=element_text(size=20), 
        legend.title=element_blank(),
        legend.key=element_blank(),
        axis.text.x = element_text(size=20)
  ) 
dev.off()



#DGIST vs Xcell : gene exp / cell type 
TGgene=c('02-Sep','ABI2','ACBD3','ACTG1','ADAMTS12','ADD1','ADH1B','ADH5','AHSA1','ALCAM','ALDOA','AMZ2','ANAPC13','ANKFY1','ANXA1','ANXA5','ARCN1','ARF4','ARHGAP6','ARL1','ASAP2','ASCC3','ASPN','ATP5G1','ATP5J','ATP6V0E1','ATP6V1D','ATXN10','ATXN2','BAD','BAG2','BAG3','BUB3','BYSL','C11orf95','C12orf10','C14orf2','C19orf24','C2orf49','C6orf120','CACNA1C','CALR','CANX','CAPN2','CAPNS1','CCDC102B','CCDC53','CCDC90B','CCL8','CCNG1','CDIPT','CDK4','CDK7','CETN2','CISD1','CIZ1','CLEC3B','CNIH4','CNN2','COG7','COPA','COPB1','COPB2','COPS2','COPS7A','COX8A','CRYZL1','CSNK1G3','CSNK2A2','CTNNA1','CUEDC2','CUL7','CUTA','DALRD3','DCTN1','DCTN4','DDA1','DDB1','DDX47','DHX29','DKKL1','DNAJC13','DPT','DPY19L4','DYNC1LI2','DYNLRB1','ECT2','EDA2R','EEF1D','EID1','EIF3I','EIF4G2','EIF6','ELN','EMILIN1','EPN2','ERC1','ERCC1','ERGIC3','ERLIN1','EXOC1','EXOC7','FAF2','FAM160B2','FAM189B','FAM98A','FBXL12','FBXO21','FBXO22','FGF7','FKTN','FSHB','FTO','GANAB','GDF10','GDF5','GLT8D1','GMPR2','GOLGA3','GORASP2','GRSF1','GTF2H5','HADHA','HDLBP','HIC1','HLCS','HOXA3','HPD','HSP90AB1','HSP90B1','HSPA8','HSPB6','HSPB7','IFT46','IGF2BP3','INVS','IPO5','ISCU','ISLR','KDELR1','KDELR2','KIF3B','KLHL9','KRT19','KTN1','LAMP1','LAPTM4A','LGALS1','LMOD1','LRRC15','LTC4S','MANF','MAP3K7','MBTPS1','MBTPS2','MCTS1','MEA1','METTL5','MIF','MINPP1','MLH3','MMADHC','MORF4L2','MPZL1','MRPL15','MRPL17','MRPL40','MRPS11','MRPS33','MTMR2','MYCT1','MYL6','MYL6B','MYOF','MYOZ2','NBR1','NCKAP1','NDUFA8','NDUFB4','NDUFS4','NDUFS5','NETO2','NFATC4','NGRN','NOP10','OCRL','OGN','P4HB','PCDHGB5','PCDHGC3','PEX12','PEX2','PFN2','PGRMC1','PHKG1','PKNOX2','PLS3','POFUT2','POLR2F','POMP','PPP2R1A','PREPL','PRKAG1','PRKG1','PRRC1','PSMB1','PSMB4','PSMB5','PSMB7','PSMC5','PSMD10','PSMD14','PTGIR','PTP4A2','PTPN11','PTTG1IP','RARS','RBMS1','RER1','RFX2','RHOC','RIN2','RING1','RNF7','RPL10','RPL35A','RPL4','RPN2','RPS19','RWDD2B','S100A10','S100A6','S1PR2','SCAMP1','SCFD1','SCRG1','SDF2','SEC61B','SEC61G','SENP5','SGCD','SHFM1','SIX5','SLC35E1','SMAD5','SNTB2','SNUPN','SNX13','SOD1','SPAG16','SPAG7','SPATA7','SPATS2','SPEG','SPIN1','SRPRB','SSBP1','SSR1','ST13','STAM2','STX12','SVEP1','TBC1D17','TBL2','TCF21','TEX261','TFG','THAP10','TIMM17A','TM2D1','TMED1','TMED7','TMED9','TMEM165','TMEM184B','TMEM59','TMEM59L','TMEM87A','TNPO2','TOMM20','TPI1','TPM3','TRAPPC4','TRIM32','TSEN34','TTC37','TUBG2','TXNL1','UFC1','UFD1L','UFSP2','UQCRQ','USO1','VAMP3','VCL','VCP','VIM','VTI1B','WDFY3','YAP1','YIPF2','ZMPSTE24','ZMYM4','ZNF358','ZNF426','ZNF471','ZNF771','ZNHIT1')

for (i in TGgene){
  print(ensemblGenes[ensemblGenes$external_gene_name == i,'ensembl_gene_id'])
}


exp =  DGIST@scale.data["ENSG00000138443",]

#TGgene=CIBERSORT celltype marker gene 
TGgene=c("ENSG00000182827","ENSG00000184009","ENSG00000151388","ENSG00000087274","ENSG00000196616","ENSG00000197894",
  "ENSG00000100591","ENSG00000170017","ENSG00000149925","ENSG00000196704","ENSG00000129055","ENSG00000185722",
  "ENSG00000135046","ENSG00000164111","ENSG00000095139","ENSG00000168374","ENSG00000047648","ENSG00000120805",
  "ENSG00000151693","ENSG00000112249","ENSG00000106819","ENSG00000159199","ENSG00000154723","ENSG00000113732",
  "ENSG00000100554","ENSG00000130638","ENSG00000204842","ENSG00000002330","ENSG00000112208","ENSG00000151929",
  "ENSG00000154473","ENSG00000112578","ENSG00000188070","ENSG00000139637","ENSG00000156411","ENSG00000228300",
  "ENSG00000135974","ENSG00000185127","ENSG00000151067","ENSG00000179218","ENSG00000127022","ENSG00000162909",
  "ENSG00000126247","ENSG00000150636","ENSG00000137500","ENSG00000108700","ENSG00000113328","ENSG00000103502",
  "ENSG00000135446","ENSG00000134058","ENSG00000147400","ENSG00000122873","ENSG00000148337","ENSG00000163815",
  "ENSG00000143771","ENSG00000064666","ENSG00000168434","ENSG00000122218","ENSG00000129083","ENSG00000184432",
  "ENSG00000166200","ENSG00000111652","ENSG00000176340","ENSG00000205758","ENSG00000151292","ENSG00000070770",
  "ENSG00000044115","ENSG00000107874","ENSG00000044090","ENSG00000112514","ENSG00000178149","ENSG00000204843",
  "ENSG00000132912","ENSG00000130311","ENSG00000167986","ENSG00000213782","ENSG00000067248","ENSG00000104901",
  "ENSG00000138246","ENSG00000143196","ENSG00000156162","ENSG00000135720","ENSG00000125971","ENSG00000114346",
  "ENSG00000131080","ENSG00000104529","ENSG00000255302","ENSG00000084623","ENSG00000110321","ENSG00000242372",
  "ENSG00000049540","ENSG00000138080","ENSG00000072134","ENSG00000082805","ENSG00000012061","ENSG00000125991",
  "ENSG00000107566","ENSG00000090989","ENSG00000182473","ENSG00000113194","ENSG00000158863","ENSG00000160767",
  "ENSG00000119812","ENSG00000127452","ENSG00000135108","ENSG00000167196","ENSG00000140285","ENSG00000106692",
  "ENSG00000131808","ENSG00000140718","ENSG00000089597","ENSG00000266524","ENSG00000125965","ENSG00000016864",
  "ENSG00000100938","ENSG00000090615","ENSG00000115806","ENSG00000132463","ENSG00000272047","ENSG00000084754",
  "ENSG00000115677","ENSG00000177374","ENSG00000159267","ENSG00000105997","ENSG00000158104","ENSG00000096384",
  "ENSG00000166598","ENSG00000109971","ENSG00000004776","ENSG00000173641","ENSG00000118096","ENSG00000136231",
  "ENSG00000119509","ENSG00000065150","ENSG00000136003","ENSG00000129009","ENSG00000105438","ENSG00000136240",
  "ENSG00000101350","ENSG00000198642","ENSG00000171345","ENSG00000126777","ENSG00000185896","ENSG00000068697",
  "ENSG00000100097","ENSG00000163431","ENSG00000172061","ENSG00000213316","ENSG00000145050","ENSG00000135341",
  "ENSG00000140943","ENSG00000012174","ENSG00000232119","ENSG00000124733","ENSG00000138382","ENSG00000240972",
  "ENSG00000107789","ENSG00000119684","ENSG00000168288","ENSG00000123562","ENSG00000197965","ENSG00000137547",
  "ENSG00000158042","ENSG00000185608","ENSG00000181991","ENSG00000090263","ENSG00000087053","ENSG00000120279",
  "ENSG00000092841","ENSG00000196465","ENSG00000138119","ENSG00000172399","ENSG00000188554","ENSG00000061676",
  "ENSG00000119421","ENSG00000065518","ENSG00000164258","ENSG00000168653","ENSG00000171208","ENSG00000100968",
  "ENSG00000182768","ENSG00000182117","ENSG00000122126","ENSG00000106809","ENSG00000185624","ENSG00000276547",
  "ENSG00000240184","ENSG00000108733","ENSG00000164751","ENSG00000070087","ENSG00000101856","ENSG00000164776",
  "ENSG00000165495","ENSG00000102024","ENSG00000186866","ENSG00000100142","ENSG00000132963","ENSG00000105568",
  "ENSG00000138078","ENSG00000181929","ENSG00000185532","ENSG00000164244","ENSG00000008018","ENSG00000159377",
  "ENSG00000100804","ENSG00000136930","ENSG00000087191","ENSG00000101843","ENSG00000115233","ENSG00000160013",
  "ENSG00000184007","ENSG00000179295","ENSG00000183255","ENSG00000113643","ENSG00000153250","ENSG00000157916",
  "ENSG00000087903","ENSG00000155366","ENSG00000132669","ENSG00000204227","ENSG00000114125","ENSG00000147403",
  "ENSG00000182899","ENSG00000174444","ENSG00000118705","ENSG00000105372","ENSG00000156253","ENSG00000197747",
  "ENSG00000197956","ENSG00000267534","ENSG00000085365","ENSG00000092108","ENSG00000164106","ENSG00000132581",
  "ENSG00000106803","ENSG00000132432","ENSG00000119231","ENSG00000170624","ENSG00000177045","ENSG00000127526",
  "ENSG00000113658","ENSG00000168807","ENSG00000169371","ENSG00000071189","ENSG00000142168","ENSG00000144451",
  "ENSG00000091640","ENSG00000042317","ENSG00000123352","ENSG00000072195","ENSG00000106723","ENSG00000144867",
  "ENSG00000106028","ENSG00000124783","ENSG00000100380","ENSG00000115145","ENSG00000117758","ENSG00000165124",
  "ENSG00000104946","ENSG00000106638","ENSG00000118526","ENSG00000144043","ENSG00000114354","ENSG00000129028",
  "ENSG00000134375","ENSG00000162604","ENSG00000099203","ENSG00000134970","ENSG00000184840","ENSG00000134851",
  "ENSG00000198792","ENSG00000116209","ENSG00000105696","ENSG00000103978","ENSG00000105576","ENSG00000173726",
  "ENSG00000111669","ENSG00000143549","ENSG00000196655","ENSG00000119401","ENSG00000170892","ENSG00000198677",
  "ENSG00000037042","ENSG00000091164","ENSG00000143222","ENSG00000109775","ENSG00000164405","ENSG00000138768",
  "ENSG00000049245","ENSG00000035403","ENSG00000165280","ENSG00000026025","ENSG00000100568","ENSG00000163625",
  "ENSG00000137693","ENSG00000130733","ENSG00000084073","ENSG00000146463","ENSG00000198816","ENSG00000130818",
  "ENSG00000196263","ENSG00000179965","ENSG00000106400")



for (i in TGgene){
  test = DGIST@scale.data[i,]
  exp <- rbind(exp,test)
}

celltypes = "Smooth muscle"

pdf(paste0("DGIST_Xcell_",celltypes,".pdf"),width=12, height=9)
df = data.frame(x=DGIST@dr$tsne@cell.embeddings[, "tSNE_1"], 
                y=DGIST@dr$tsne@cell.embeddings[, "tSNE_2"], 
                expression=colSums(exp))
ggplot(df,aes(x=x, y=y, colour=expression),mar=c(0,0,3,0)) + 
  ggtitle(paste0(celltypes, " gene exp")) +
  geom_point(size=0.5) + 
  scale_colour_gradientn(colours = rev(brewer.pal(11, "RdBu"))) +
  ylab("Component 2") + 
  xlab("Component 1") + 
  theme_bw() +
  theme(text = element_text(size=20),
        panel.grid.major=element_blank(),
        panel.grid.minor=element_blank(), 
        axis.line=element_line(size=1),
        axis.ticks=element_line(size=1),
        legend.text=element_text(size=20), 
        legend.title=element_blank(),
        legend.key=element_blank(),
        axis.text.x = element_text(size=20)
  ) 
dev.off()

#####################################################
#####################################################
immune cell pop 따로
#####################################################
setwd('/storage2/Project/CSC/10X/DGIST_data')
DGIST=readRDS(file="BC_seurat.rds")

data_to_write_out <- as.data.frame(as.matrix(DGIST@scale.data))

fwrite(x = data_to_write_out, row.names = TRUE, file = "outfile.csv")

write.csv(BC_seurat.markers.genesymbol, file="PE26_BC_5000_seurat.markers.genesymbol.csv")

